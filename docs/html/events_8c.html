<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CBUSlib: events.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CBUSlib<span id="projectnumber">&#160;2m</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('events_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">events.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stddef.h&gt;</code><br />
<code>#include &quot;module.h&quot;</code><br />
<code>#include &quot;<a class="el" href="_fli_m_8h_source.html">FliM.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="events_8h_source.html">events.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="cbus_8h_source.html">cbus.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="romops_8h_source.html">romops.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="timed_response_8h_source.html">timedResponse.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a58343610091d13263059d835ded59159"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a58343610091d13263059d835ded59159">rebuildHashtable</a> (void)</td></tr>
<tr class="memdesc:a58343610091d13263059d835ded59159"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the RAM hash chain for reverse lookup of event to action.  <a href="events_8c.html#a58343610091d13263059d835ded59159">More...</a><br /></td></tr>
<tr class="separator:a58343610091d13263059d835ded59159"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad53fa0d8aadbbd46fdf6cb1473ddc392"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#ad53fa0d8aadbbd46fdf6cb1473ddc392">getHash</a> (WORD nn, WORD en)</td></tr>
<tr class="memdesc:ad53fa0d8aadbbd46fdf6cb1473ddc392"><td class="mdescLeft">&#160;</td><td class="mdescRight">Obtain a hash for the specified <a class="el" href="struct_event.html">Event</a>.  <a href="events_8c.html#ad53fa0d8aadbbd46fdf6cb1473ddc392">More...</a><br /></td></tr>
<tr class="separator:ad53fa0d8aadbbd46fdf6cb1473ddc392"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7771d5fa9069b96dd26a09499cc5cf91"><td class="memItemLeft" align="right" valign="top">BYTE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a7771d5fa9069b96dd26a09499cc5cf91">tableIndexToEvtIdx</a> (BYTE tableIndex)</td></tr>
<tr class="memdesc:a7771d5fa9069b96dd26a09499cc5cf91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert an internal tableIndex into a CBUS EvtIdx.  <a href="events_8c.html#a7771d5fa9069b96dd26a09499cc5cf91">More...</a><br /></td></tr>
<tr class="separator:a7771d5fa9069b96dd26a09499cc5cf91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd98bbf7bc4c92fcfc0abf597bf2d8d9"><td class="memItemLeft" align="right" valign="top">BYTE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#abd98bbf7bc4c92fcfc0abf597bf2d8d9">evtIdxToTableIndex</a> (BYTE evtIdx)</td></tr>
<tr class="memdesc:abd98bbf7bc4c92fcfc0abf597bf2d8d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert an evtIdx from CBUS to an index into the eventTable.  <a href="events_8c.html#abd98bbf7bc4c92fcfc0abf597bf2d8d9">More...</a><br /></td></tr>
<tr class="separator:abd98bbf7bc4c92fcfc0abf597bf2d8d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac94692cd8922b3ce50bc71433304689e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#ac94692cd8922b3ce50bc71433304689e">checkRemoveTableEntry</a> (unsigned char tableIndex)</td></tr>
<tr class="memdesc:ac94692cd8922b3ce50bc71433304689e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check to see if any event entries can be removed.  <a href="events_8c.html#ac94692cd8922b3ce50bc71433304689e">More...</a><br /></td></tr>
<tr class="separator:ac94692cd8922b3ce50bc71433304689e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a165732e597580fb7fd2b50384473edb4"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a165732e597580fb7fd2b50384473edb4">removeTableEntry</a> (unsigned char tableIndex)</td></tr>
<tr class="separator:a165732e597580fb7fd2b50384473edb4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaac0e45bf22f14b123bd44feea457725"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#aaac0e45bf22f14b123bd44feea457725">writeEv</a> (unsigned char tableIndex, BYTE evNum, BYTE evVal)</td></tr>
<tr class="memdesc:aaac0e45bf22f14b123bd44feea457725"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write an EV value to an event.  <a href="events_8c.html#aaac0e45bf22f14b123bd44feea457725">More...</a><br /></td></tr>
<tr class="separator:aaac0e45bf22f14b123bd44feea457725"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57b60268d21a151c3f33a2027ee28a55"><td class="memItemLeft" align="right" valign="top">WORD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a57b60268d21a151c3f33a2027ee28a55">getNN</a> (unsigned char tableIndex)</td></tr>
<tr class="memdesc:a57b60268d21a151c3f33a2027ee28a55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the NN for an event.  <a href="events_8c.html#a57b60268d21a151c3f33a2027ee28a55">More...</a><br /></td></tr>
<tr class="separator:a57b60268d21a151c3f33a2027ee28a55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92dc9b256e5ebac21a4b23508ef361f2"><td class="memItemLeft" align="right" valign="top">WORD&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a92dc9b256e5ebac21a4b23508ef361f2">getEN</a> (unsigned char tableIndex)</td></tr>
<tr class="memdesc:a92dc9b256e5ebac21a4b23508ef361f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the EN for an event.  <a href="events_8c.html#a92dc9b256e5ebac21a4b23508ef361f2">More...</a><br /></td></tr>
<tr class="separator:a92dc9b256e5ebac21a4b23508ef361f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e260cd1dd98ce6ef4912a04bf63d9a2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a2e260cd1dd98ce6ef4912a04bf63d9a2">processEvent</a> (unsigned char action, BYTE *msg)</td></tr>
<tr class="separator:a2e260cd1dd98ce6ef4912a04bf63d9a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ab0e8dd8197f4b7b2a086c4dee320b6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a5ab0e8dd8197f4b7b2a086c4dee320b6">eventsInit</a> (void)</td></tr>
<tr class="memdesc:a5ab0e8dd8197f4b7b2a086c4dee320b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">eventsInit called during initialisation - initialises event support.  <a href="events_8c.html#a5ab0e8dd8197f4b7b2a086c4dee320b6">More...</a><br /></td></tr>
<tr class="separator:a5ab0e8dd8197f4b7b2a086c4dee320b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a327a3f9286cb4fb347187b5d764d33a9"><td class="memItemLeft" align="right" valign="top">BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a327a3f9286cb4fb347187b5d764d33a9">validStart</a> (unsigned char tableIndex)</td></tr>
<tr class="memdesc:a327a3f9286cb4fb347187b5d764d33a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks if the specified index is the start of a set of linked entries.  <a href="events_8c.html#a327a3f9286cb4fb347187b5d764d33a9">More...</a><br /></td></tr>
<tr class="separator:a327a3f9286cb4fb347187b5d764d33a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4393a17e7de4cabd8d428d71445ca455"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a4393a17e7de4cabd8d428d71445ca455">clearAllEvents</a> (void)</td></tr>
<tr class="memdesc:a4393a17e7de4cabd8d428d71445ca455"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes all events including default events.  <a href="events_8c.html#a4393a17e7de4cabd8d428d71445ca455">More...</a><br /></td></tr>
<tr class="separator:a4393a17e7de4cabd8d428d71445ca455"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedde0967805e797ca53aafff69675db0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#aedde0967805e797ca53aafff69675db0">doNnevn</a> (void)</td></tr>
<tr class="memdesc:aedde0967805e797ca53aafff69675db0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read number of available event slots.  <a href="events_8c.html#aedde0967805e797ca53aafff69675db0">More...</a><br /></td></tr>
<tr class="separator:aedde0967805e797ca53aafff69675db0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca92c4135fcea71596bdb8bd0b302e77"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#aca92c4135fcea71596bdb8bd0b302e77">doNerd</a> (void)</td></tr>
<tr class="memdesc:aca92c4135fcea71596bdb8bd0b302e77"><td class="mdescLeft">&#160;</td><td class="mdescRight">Do the NERD.  <a href="events_8c.html#aca92c4135fcea71596bdb8bd0b302e77">More...</a><br /></td></tr>
<tr class="separator:aca92c4135fcea71596bdb8bd0b302e77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6bc205576cee4fba22cd9570d0990f00"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a6bc205576cee4fba22cd9570d0990f00">doNenrd</a> (unsigned char index)</td></tr>
<tr class="memdesc:a6bc205576cee4fba22cd9570d0990f00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a single stored event by index and return a ENRSP response.  <a href="events_8c.html#a6bc205576cee4fba22cd9570d0990f00">More...</a><br /></td></tr>
<tr class="separator:a6bc205576cee4fba22cd9570d0990f00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebd85a54eb6198c2ddd9322bb92bd181"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#aebd85a54eb6198c2ddd9322bb92bd181">doRqevn</a> (void)</td></tr>
<tr class="memdesc:aebd85a54eb6198c2ddd9322bb92bd181"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read number of stored events.  <a href="events_8c.html#aebd85a54eb6198c2ddd9322bb92bd181">More...</a><br /></td></tr>
<tr class="separator:aebd85a54eb6198c2ddd9322bb92bd181"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46e1b0b232033a936f5649a03eaa8313"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a46e1b0b232033a936f5649a03eaa8313">removeEvent</a> (WORD nodeNumber, WORD eventNumber)</td></tr>
<tr class="memdesc:a46e1b0b232033a936f5649a03eaa8313"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove event.  <a href="events_8c.html#a46e1b0b232033a936f5649a03eaa8313">More...</a><br /></td></tr>
<tr class="separator:a46e1b0b232033a936f5649a03eaa8313"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab655573d0c7c647073ae86916b8765b"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#aab655573d0c7c647073ae86916b8765b">addEvent</a> (WORD nodeNumber, WORD eventNumber, BYTE evNum, BYTE evVal, BOOL forceOwnNN)</td></tr>
<tr class="memdesc:aab655573d0c7c647073ae86916b8765b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an event/EV.  <a href="events_8c.html#aab655573d0c7c647073ae86916b8765b">More...</a><br /></td></tr>
<tr class="separator:aab655573d0c7c647073ae86916b8765b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac87faac706b02e4726da9f78c51cc972"><td class="memItemLeft" align="right" valign="top">unsigned char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#ac87faac706b02e4726da9f78c51cc972">findEvent</a> (WORD nodeNumber, WORD eventNumber)</td></tr>
<tr class="memdesc:ac87faac706b02e4726da9f78c51cc972"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find an event in the eventTable and return it's index.  <a href="events_8c.html#ac87faac706b02e4726da9f78c51cc972">More...</a><br /></td></tr>
<tr class="separator:ac87faac706b02e4726da9f78c51cc972"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adadf68f001a0ee868739846f3d03c2d9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#adadf68f001a0ee868739846f3d03c2d9">getEv</a> (unsigned char tableIndex, unsigned char evNum)</td></tr>
<tr class="memdesc:adadf68f001a0ee868739846f3d03c2d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return an EV value for an event.  <a href="events_8c.html#adadf68f001a0ee868739846f3d03c2d9">More...</a><br /></td></tr>
<tr class="separator:adadf68f001a0ee868739846f3d03c2d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2efb155da88cac9e44c8f55b6b929d1e"><td class="memItemLeft" align="right" valign="top">BYTE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a2efb155da88cac9e44c8f55b6b929d1e">numEv</a> (unsigned char tableIndex)</td></tr>
<tr class="memdesc:a2efb155da88cac9e44c8f55b6b929d1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the number of EVs for an event.  <a href="events_8c.html#a2efb155da88cac9e44c8f55b6b929d1e">More...</a><br /></td></tr>
<tr class="separator:a2efb155da88cac9e44c8f55b6b929d1e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03925df44624ce86799dcfc6ed189e0d"><td class="memItemLeft" align="right" valign="top">BYTE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a03925df44624ce86799dcfc6ed189e0d">getEVs</a> (unsigned char tableIndex)</td></tr>
<tr class="separator:a03925df44624ce86799dcfc6ed189e0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a995b47ddce8d6ca807e9f116b9cc8998"><td class="memItemLeft" align="right" valign="top">BOOL&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a995b47ddce8d6ca807e9f116b9cc8998">parseCbusEvent</a> (BYTE *msg)</td></tr>
<tr class="memdesc:a995b47ddce8d6ca807e9f116b9cc8998"><td class="mdescLeft">&#160;</td><td class="mdescRight">This Consumes a CBUS event if it has been provisioned.  <a href="events_8c.html#a995b47ddce8d6ca807e9f116b9cc8998">More...</a><br /></td></tr>
<tr class="separator:a995b47ddce8d6ca807e9f116b9cc8998"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ae713acad570622bbebaa115927866511"><td class="memItemLeft" align="right" valign="top">rom near <a class="el" href="struct_event_table.html">EventTable</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#ae713acad570622bbebaa115927866511">eventTable</a> = (rom near <a class="el" href="struct_event_table.html">EventTable</a>*)AT_EVENTS</td></tr>
<tr class="memdesc:ae713acad570622bbebaa115927866511"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="struct_event.html">Event</a> handling.  <a href="events_8c.html#ae713acad570622bbebaa115927866511">More...</a><br /></td></tr>
<tr class="separator:ae713acad570622bbebaa115927866511"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a693231f077ad2dc67af3303b576c5155"><td class="memItemLeft" align="right" valign="top">BYTE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a693231f077ad2dc67af3303b576c5155">happening2Event</a> [NUM_HAPPENINGS]</td></tr>
<tr class="separator:a693231f077ad2dc67af3303b576c5155"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a982e99e84a8e6f4071b6fb4ee380ce16"><td class="memItemLeft" align="right" valign="top">BYTE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a982e99e84a8e6f4071b6fb4ee380ce16">eventChains</a> [HASH_LENGTH][CHAIN_LENGTH]</td></tr>
<tr class="separator:a982e99e84a8e6f4071b6fb4ee380ce16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d5636528238c1fdce8d095fa9b988f3"><td class="memItemLeft" align="right" valign="top">BYTE&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="events_8c.html#a2d5636528238c1fdce8d095fa9b988f3">evs</a> [EVperEVT]</td></tr>
<tr class="memdesc:a2d5636528238c1fdce8d095fa9b988f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return all the EV values for an event.  <a href="events_8c.html#a2d5636528238c1fdce8d095fa9b988f3">More...</a><br /></td></tr>
<tr class="separator:a2d5636528238c1fdce8d095fa9b988f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aab655573d0c7c647073ae86916b8765b" name="aab655573d0c7c647073ae86916b8765b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab655573d0c7c647073ae86916b8765b">&#9670;&nbsp;</a></span>addEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char addEvent </td>
          <td>(</td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>nodeNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>eventNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BYTE&#160;</td>
          <td class="paramname"><em>evNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BYTE&#160;</td>
          <td class="paramname"><em>evVal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BOOL&#160;</td>
          <td class="paramname"><em>forceOwnNN</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add an event/EV. </p>
<p >Teach or re-teach an EV for an event. This may (optionally) need to create a new event and then optionally create additional chained entries. All newly allocated table entries need to be initialised.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nodeNumber</td><td></td></tr>
    <tr><td class="paramname">eventNumber</td><td></td></tr>
    <tr><td class="paramname">evNum</td><td>the EV index (starts at 0 for the produced action) </td></tr>
    <tr><td class="paramname">evVal</td><td>the EV value </td></tr>
    <tr><td class="paramname">forceOwnNN</td><td>the value of the flag </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>error number or 0 for success </dd></dl>

</div>
</div>
<a id="ac94692cd8922b3ce50bc71433304689e" name="ac94692cd8922b3ce50bc71433304689e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac94692cd8922b3ce50bc71433304689e">&#9670;&nbsp;</a></span>checkRemoveTableEntry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkRemoveTableEntry </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>tableIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check to see if any event entries can be removed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tableIndex</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4393a17e7de4cabd8d428d71445ca455" name="a4393a17e7de4cabd8d428d71445ca455"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4393a17e7de4cabd8d428d71445ca455">&#9670;&nbsp;</a></span>clearAllEvents()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clearAllEvents </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Removes all events including default events. </p>

</div>
</div>
<a id="a6bc205576cee4fba22cd9570d0990f00" name="a6bc205576cee4fba22cd9570d0990f00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6bc205576cee4fba22cd9570d0990f00">&#9670;&nbsp;</a></span>doNenrd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doNenrd </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>index</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read a single stored event by index and return a ENRSP response. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">index</td><td>index into event table </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aca92c4135fcea71596bdb8bd0b302e77" name="aca92c4135fcea71596bdb8bd0b302e77"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca92c4135fcea71596bdb8bd0b302e77">&#9670;&nbsp;</a></span>doNerd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doNerd </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Do the NERD. </p>
<p >This sets things up so that timedResponse will do the right stuff. </p>

</div>
</div>
<a id="aedde0967805e797ca53aafff69675db0" name="aedde0967805e797ca53aafff69675db0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aedde0967805e797ca53aafff69675db0">&#9670;&nbsp;</a></span>doNnevn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doNnevn </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read number of available event slots. </p>
<p >This returned the number of unused slots in the Consumed event Event2Action table. </p>

</div>
</div>
<a id="aebd85a54eb6198c2ddd9322bb92bd181" name="aebd85a54eb6198c2ddd9322bb92bd181"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebd85a54eb6198c2ddd9322bb92bd181">&#9670;&nbsp;</a></span>doRqevn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void doRqevn </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read number of stored events. </p>
<p >This returns the number of events which is different to the number of used slots in the <a class="el" href="struct_event.html">Event</a> table. </p>

</div>
</div>
<a id="a5ab0e8dd8197f4b7b2a086c4dee320b6" name="a5ab0e8dd8197f4b7b2a086c4dee320b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ab0e8dd8197f4b7b2a086c4dee320b6">&#9670;&nbsp;</a></span>eventsInit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void eventsInit </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>eventsInit called during initialisation - initialises event support. </p>
<p >Called after power up to initialise RAM. </p>

</div>
</div>
<a id="abd98bbf7bc4c92fcfc0abf597bf2d8d9" name="abd98bbf7bc4c92fcfc0abf597bf2d8d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd98bbf7bc4c92fcfc0abf597bf2d8d9">&#9670;&nbsp;</a></span>evtIdxToTableIndex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BYTE evtIdxToTableIndex </td>
          <td>(</td>
          <td class="paramtype">BYTE&#160;</td>
          <td class="paramname"><em>evtIdx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert an evtIdx from CBUS to an index into the eventTable. </p>
<p >The CBUS spec uses "EN#" as an index into an "Event Table". This is very implementation specific. In this implementation we do actually have an event table behind the scenes so we can have an EN#. However we may also wish to provide some kind of mapping between the CBUS index and out actual implementation specific index. These functions allow us to have a mapping. I currently I just adjust by 1 since the CBUS index starts at 1 whilst the eventTable index starts at 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">evtIdx</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an index into eventTable </dd></dl>

</div>
</div>
<a id="ac87faac706b02e4726da9f78c51cc972" name="ac87faac706b02e4726da9f78c51cc972"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac87faac706b02e4726da9f78c51cc972">&#9670;&nbsp;</a></span>findEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char findEvent </td>
          <td>(</td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>nodeNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>eventNumber</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find an event in the eventTable and return it's index. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nodeNumber</td><td></td></tr>
    <tr><td class="paramname">eventNumber</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>index into eventTable or NO_INDEX if not present </dd></dl>

</div>
</div>
<a id="a92dc9b256e5ebac21a4b23508ef361f2" name="a92dc9b256e5ebac21a4b23508ef361f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92dc9b256e5ebac21a4b23508ef361f2">&#9670;&nbsp;</a></span>getEN()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WORD getEN </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>tableIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the EN for an event. </p>
<p >Getter so that the application code can obtain information about the event.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tableIndex</td><td>the index of the start of an event </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the <a class="el" href="struct_event.html">Event</a> Number </dd></dl>

</div>
</div>
<a id="adadf68f001a0ee868739846f3d03c2d9" name="adadf68f001a0ee868739846f3d03c2d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adadf68f001a0ee868739846f3d03c2d9">&#9670;&nbsp;</a></span>getEv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getEv </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>tableIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>evNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return an EV value for an event. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tableIndex</td><td>the index of the start of an event </td></tr>
    <tr><td class="paramname">evNum</td><td>ev number starts at 0 (produced) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the ev value or -error code if error </dd></dl>

</div>
</div>
<a id="a03925df44624ce86799dcfc6ed189e0d" name="a03925df44624ce86799dcfc6ed189e0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03925df44624ce86799dcfc6ed189e0d">&#9670;&nbsp;</a></span>getEVs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BYTE getEVs </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>tableIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad53fa0d8aadbbd46fdf6cb1473ddc392" name="ad53fa0d8aadbbd46fdf6cb1473ddc392"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad53fa0d8aadbbd46fdf6cb1473ddc392">&#9670;&nbsp;</a></span>getHash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char getHash </td>
          <td>(</td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>nn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>en</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Obtain a hash for the specified <a class="el" href="struct_event.html">Event</a>. </p>
<p >The hash table uses an algorithm of an XOR of all the bytes with appropriate shifts.</p>
<p >If we used just the node number, then all short events would hash to the same number If we used just the event number, then for long events the vast majority would be 1 to 8, so not giving a very good spread.</p>
<p >This algorithm hopefully produces a good spread for layouts with either predominantly short events, long events or a mixture. This also means that for layouts using the default FLiM node numbers from 256, we are effectively starting from zero as far as the hash algorithm is concerned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>the event </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the hash </dd></dl>

</div>
</div>
<a id="a57b60268d21a151c3f33a2027ee28a55" name="a57b60268d21a151c3f33a2027ee28a55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57b60268d21a151c3f33a2027ee28a55">&#9670;&nbsp;</a></span>getNN()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">WORD getNN </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>tableIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the NN for an event. </p>
<p >Getter so that the application code can obtain information about the event.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tableIndex</td><td>the index of the start of an event </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the Node Number </dd></dl>

</div>
</div>
<a id="a2efb155da88cac9e44c8f55b6b929d1e" name="a2efb155da88cac9e44c8f55b6b929d1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2efb155da88cac9e44c8f55b6b929d1e">&#9670;&nbsp;</a></span>numEv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BYTE numEv </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>tableIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the number of EVs for an event. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tableIndex</td><td>the index of the start of an event </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the number of EVs </dd></dl>

</div>
</div>
<a id="a995b47ddce8d6ca807e9f116b9cc8998" name="a995b47ddce8d6ca807e9f116b9cc8998"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a995b47ddce8d6ca807e9f116b9cc8998">&#9670;&nbsp;</a></span>parseCbusEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL parseCbusEvent </td>
          <td>(</td>
          <td class="paramtype">BYTE *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This Consumes a CBUS event if it has been provisioned. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

</div>
</div>
<a id="a2e260cd1dd98ce6ef4912a04bf63d9a2" name="a2e260cd1dd98ce6ef4912a04bf63d9a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2e260cd1dd98ce6ef4912a04bf63d9a2">&#9670;&nbsp;</a></span>processEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processEvent </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>action</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BYTE *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a58343610091d13263059d835ded59159" name="a58343610091d13263059d835ded59159"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58343610091d13263059d835ded59159">&#9670;&nbsp;</a></span>rebuildHashtable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rebuildHashtable </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise the RAM hash chain for reverse lookup of event to action. </p>
<p >Uses the data from the Flash Event2Action table. </p>

</div>
</div>
<a id="a46e1b0b232033a936f5649a03eaa8313" name="a46e1b0b232033a936f5649a03eaa8313"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a46e1b0b232033a936f5649a03eaa8313">&#9670;&nbsp;</a></span>removeEvent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char removeEvent </td>
          <td>(</td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>nodeNumber</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WORD&#160;</td>
          <td class="paramname"><em>eventNumber</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove event. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">nodeNumber</td><td></td></tr>
    <tr><td class="paramname">eventNumber</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>error or 0 for success </dd></dl>

</div>
</div>
<a id="a165732e597580fb7fd2b50384473edb4" name="a165732e597580fb7fd2b50384473edb4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a165732e597580fb7fd2b50384473edb4">&#9670;&nbsp;</a></span>removeTableEntry()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char removeTableEntry </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>tableIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7771d5fa9069b96dd26a09499cc5cf91" name="a7771d5fa9069b96dd26a09499cc5cf91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7771d5fa9069b96dd26a09499cc5cf91">&#9670;&nbsp;</a></span>tableIndexToEvtIdx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BYTE tableIndexToEvtIdx </td>
          <td>(</td>
          <td class="paramtype">BYTE&#160;</td>
          <td class="paramname"><em>tableIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert an internal tableIndex into a CBUS EvtIdx. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tableIndex</td><td>index into the eventTable </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>an CBUS EvtIdx </dd></dl>

</div>
</div>
<a id="a327a3f9286cb4fb347187b5d764d33a9" name="a327a3f9286cb4fb347187b5d764d33a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a327a3f9286cb4fb347187b5d764d33a9">&#9670;&nbsp;</a></span>validStart()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BOOL validStart </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>tableIndex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks if the specified index is the start of a set of linked entries. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tableIndex</td><td>the index into eventtable to check </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the specified index is the start of a linked set </dd></dl>

</div>
</div>
<a id="aaac0e45bf22f14b123bd44feea457725" name="aaac0e45bf22f14b123bd44feea457725"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaac0e45bf22f14b123bd44feea457725">&#9670;&nbsp;</a></span>writeEv()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char writeEv </td>
          <td>(</td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>tableIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BYTE&#160;</td>
          <td class="paramname"><em>evNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BYTE&#160;</td>
          <td class="paramname"><em>evVal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write an EV value to an event. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tableIndex</td><td>the index into the event table </td></tr>
    <tr><td class="paramname">evNum</td><td>the EV number (0 for the produced action) </td></tr>
    <tr><td class="paramname">evVal</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if success otherwise the error </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a982e99e84a8e6f4071b6fb4ee380ce16" name="a982e99e84a8e6f4071b6fb4ee380ce16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a982e99e84a8e6f4071b6fb4ee380ce16">&#9670;&nbsp;</a></span>eventChains</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BYTE eventChains[HASH_LENGTH][CHAIN_LENGTH]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae713acad570622bbebaa115927866511" name="ae713acad570622bbebaa115927866511"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae713acad570622bbebaa115927866511">&#9670;&nbsp;</a></span>eventTable</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rom near <a class="el" href="struct_event_table.html">EventTable</a>* eventTable = (rom near <a class="el" href="struct_event_table.html">EventTable</a>*)AT_EVENTS</td>
        </tr>
      </table>
</div><div class="memdoc">

<p><a class="el" href="struct_event.html">Event</a> handling. </p>
<p >The events are stored as a hash table in flash (flash is faster to read than EEPROM) There can be up to 255 events. Since the address in the hash table will be 16 bits, and the address of the whole event table can also be covered by a 16 bit address, there is no advantage in having a separate hashed index table pointing to the actual event table. Therefore the hashing algorithm produces the index into the actual event table, which can be shifted to give the address - each event table entry is 16 bytes. After the event number and hash table overhead, this allows up to 10 EVs per event.</p>
<p >This generic FLiM code needs no knowledge of specific EV usage except that EV#1 is to define the Produced events (if the PRODUCED_EVENTS definition is defined).</p>
<p >BEWARE must set NUM_EVENTS to a maximum of 255! If set to 256 then the for (unsigned char i=0; i&lt;NUM_EVENTS; i++) loops will never end as they use an unsigned char instead of int for space/performance reasons.</p>
<p >BEWARE Concurrency: The functions which use the eventTable and hash/lookup must not be used whilst there is a chance of the functions which modify the eventTable of RAM based hash/lookup tables being called. These functions should therefore either be called from the same thread or disable interrupts.</p>
<p >define HASH_TABLE to use event hash tables for fast access - at the expense of some RAM</p>
<p >The code in event.c is responsible for storing EVs for each defined event and also for allowing speedy lookup of EVs given an <a class="el" href="struct_event.html">Event</a> or finding an <a class="el" href="struct_event.html">Event</a> given a Happening which is stored in EV#1.</p>
<p >Events are stored in the <a class="el" href="struct_event_table.html">EventTable</a> which consists of rows containing the following fields:</p><ul>
<li><a class="el" href="union_event_table_flags.html">EventTableFlags</a> flags 1 byte</li>
<li>BYTE next 1 byte</li>
<li><a class="el" href="struct_event.html">Event</a> event 4 bytes</li>
<li>BYTE evs[EVENT_TABLE_WIDTH] EVENT_TABLE_WIDTH bytes</li>
</ul>
<p >The number of table entries is defined by NUM_EVENTS.</p>
<p >The EVENT_TABLE_WIDTH determines the number of EVs that can be stored within a single <a class="el" href="struct_event_table.html">EventTable</a> row. Where events can have more EVs that can be fitted within a single row then multiple rows are chained together using the 'next' field. 'next' indicates the index into the <a class="el" href="struct_event_table.html">EventTable</a> for chained entries for a single <a class="el" href="struct_event.html">Event</a>.</p>
<p >An example to clarify is the CANMIO which sets EVENT_TABLE_WITH to 10 so that size of a row is 16bytes. A chain of two rows can store 20 EVs. CANMIO has a limit of 20 EVs per event (EVperEVT) so that a maximum of 2 entries are chained.</p>
<p >The 'event' field is only used in the first in a chain of entries and contains the NN/EN of the event.</p>
<p >The <a class="el" href="union_event_table_flags.html">EventTableFlags</a> have the following entries: eVsUsed 4 bits continued 1 bit forceOwnNN 1 bit freeEntry 1 bit</p>
<p >The 'continued' flag indicates if there is another table entry chained to this one. If the flag is set then the 'next' field contains the index of the chained entry.</p>
<p >The 'forceOwnNN' flag indicates that for produced events the NN in the event field should be ignored and the module's current NN should be used instead. This allows default events to be maintained even if the NN of the module is changed. Therefore this flag should be set for default produced events.</p>
<p >The 'freeEntry' flag indicates that this entry in the <a class="el" href="struct_event_table.html">EventTable</a> is currently unused.</p>
<p >The 'eVsUsed' field records how many of the evs contain valid data. It is only applicable for the last entry in the chain since all EVs less than this are assumed to contain valid data. Since this field is only 4 bits long this places a limit on the EVENT_TABLE_WIDTH of 15.</p>
<p >EXAMPLE Let's go through an example of filling in the table. We'll look at the first 4 entries in the table and let's have EVENT_TABLE_WIDTH=4 but have EVperEVT=8.</p>
<p >At the outset there is an empty table. All rows have the 'freeEntry' bit set:</p>
<p >index eVsUsed continued forceOwnNN freeEntry next <a class="el" href="struct_event.html">Event</a> evs[] 0 0 0 0 1 0 0:0 0,0,0,0 1 0 0 0 1 0 0:0 0,0,0,0 2 0 0 0 1 0 0:0 0,0,0,0 3 0 0 0 1 0 0:0 0,0,0,0</p>
<p >Now if an EV of an event is set (probably using EVLRN CBUS command) then the table is updated. Let's set EV#1 for event 256:101 to the value 99:</p>
<p >index eVsUsed continued forceOwnNN freeEntry next <a class="el" href="struct_event.html">Event</a> evs[] 0 1 0 0 0 0 256:101 99,0,0,0 1 0 0 0 1 0 0:0 0,0,0,0 2 0 0 0 1 0 0:0 0,0,0,0 3 0 0 0 1 0 0:0 0,0,0,0</p>
<p >Now let's set EV#2 of event 256:102 to 15:</p>
<p >index eVsUsed continued forceOwnNN freeEntry next <a class="el" href="struct_event.html">Event</a> evs[] 0 1 0 0 0 0 256:101 99,0,0,0 1 2 0 0 0 0 256:102 0,15,0,0 2 0 0 0 1 0 0:0 0,0,0,0 3 0 0 0 1 0 0:0 0,0,0,0</p>
<p >Now let's set EV#8 of event 256:101 to 29:</p>
<p >index eVsUsed continued forceOwnNN freeEntry next <a class="el" href="struct_event.html">Event</a> evs[] 0 1 1 0 0 0 256:101 99,0,0,0 1 2 0 0 0 0 256:102 0,15,0,0 2 4 0 0 0 0 0:0 0,0,0,29 3 0 0 0 1 0 0:0 0,0,0,0</p>
<p >To perform the speedy lookup of EVs given an <a class="el" href="struct_event.html">Event</a> a hash table can be used by defining HASH_TABLE. The hash table is stored in BYTE eventChains[HASH_LENGTH][CHAIN_LENGTH];</p>
<p >An event hashing function is provided BYTE getHash(nn, en) which should give a reasonable distribution of hash values given the typical events used.</p>
<p >This table is populated from the <a class="el" href="struct_event_table.html">EventTable</a> upon power up using <a class="el" href="events_8c.html#a58343610091d13263059d835ded59159" title="Initialise the RAM hash chain for reverse lookup of event to action.">rebuildHashtable()</a>. This function must be called before attempting to use the hash table. Each <a class="el" href="struct_event.html">Event</a> from the <a class="el" href="struct_event_table.html">EventTable</a> is hashed using getHash(nn,en), trimmed to the HASH_LENGTH and the index in the <a class="el" href="struct_event_table.html">EventTable</a> is then stored in the eventChains at the next available bucket position.</p>
<p >When an <a class="el" href="struct_event.html">Event</a> is received from CBUS and we need to find its index within the <a class="el" href="struct_event_table.html">EventTable</a> it is firstly hashed using getHash(nn,en), trimmed to HASH_LENGTH and this is used as the first index into eventChains[][]. We then step through the second index of buckets within the chain. Each entry is an index into the eventTable and the eventTable's event field is checked to see if it matches the received event. It it does match then the index into eventTable has been found and is returned. The EVs can then be accessed from the ev[] field.</p>
<p >If PRODUCED_EVENTS is defined in addition to HASH_TABLE then an additional lookup table BYTE action2Event[NUM_HAPPENINGS] is used to obtain an <a class="el" href="struct_event.html">Event</a> using a Happening (previously called Actions) stored in EV#1. This table is also populated using rebuildHashTable(). Given a Happening this table can be used to obtain the index into the <a class="el" href="struct_event_table.html">EventTable</a> for the Happening so the <a class="el" href="struct_event.html">Event</a> at that index in the <a class="el" href="struct_event_table.html">EventTable</a> can be transmitted onto the CBUS. </p>

</div>
</div>
<a id="a2d5636528238c1fdce8d095fa9b988f3" name="a2d5636528238c1fdce8d095fa9b988f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d5636528238c1fdce8d095fa9b988f3">&#9670;&nbsp;</a></span>evs</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BYTE evs[EVperEVT]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return all the EV values for an event. </p>
<p >EVs are put into the global evs array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tableIndex</td><td>the index of the start of an event </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the error code or 0 for no error </dd></dl>

</div>
</div>
<a id="a693231f077ad2dc67af3303b576c5155" name="a693231f077ad2dc67af3303b576c5155"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a693231f077ad2dc67af3303b576c5155">&#9670;&nbsp;</a></span>happening2Event</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BYTE happening2Event[NUM_HAPPENINGS]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="events_8c.html">events.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
